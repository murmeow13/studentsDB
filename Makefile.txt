# Makefile for Student Database with Built-in Tests
CXX = g++
CXXFLAGS = -std=c++11 -Wall -Wextra -pedantic
TEST_FLAGS = -DTEST_MODE
PROGRAM = student_db
TEST_EXEC = student_tests
SOURCE = student_database.cpp

# Colors for better visibility
GREEN = \033[0;32m
YELLOW = \033[0;33m
RED = \033[0;31m
BLUE = \033[0;34m
NC = \033[0m # No Color

.PHONY: all program test run-tests run-program clean help ci

all: program test

program:
	@echo "$(BLUE)Building main program...$(NC)"
	$(CXX) $(CXXFLAGS) -o $(PROGRAM) $(SOURCE)
	@echo "$(GREEN)✓ Program built successfully: $(PROGRAM)$(NC)"

test:
	@echo "$(BLUE)Building test executable...$(NC)"
	$(CXX) $(CXXFLAGS) $(TEST_FLAGS) -o $(TEST_EXEC) $(SOURCE)
	@echo "$(GREEN)✓ Test executable built successfully: $(TEST_EXEC)$(NC)"

run-tests: test
	@echo "$(YELLOW)Running all tests...$(NC)"
	@./$(TEST_EXEC) || (echo "$(RED)❌ Tests failed!$(NC)" && exit 1)
	@echo "$(GREEN)✅ All tests passed!$(NC)"

run-program: program
	@echo "$(YELLOW)Running main program...$(NC)"
	@./$(PROGRAM)

clean:
	@echo "$(BLUE)Cleaning up...$(NC)"
	@rm -rf $(PROGRAM) $(TEST_EXEC) *.o
	@echo "$(GREEN)✓ Clean completed$(NC)"

help:
	@echo "$(YELLOW)Student Database Makefile Commands:$(NC)"
	@echo "  make all        - Build program and test executable"
	@echo "  make program    - Build main program only"
	@echo "  make test       - Build test executable only"
	@echo "  make run-tests  - Build and run tests"
	@echo "  make run-program - Build and run main program"
	@echo "  make clean      - Clean build artifacts"
	@echo "  make help       - Show this help message"

# GitHub Actions target
ci: run-tests

# Default target
.DEFAULT_GOAL := help
